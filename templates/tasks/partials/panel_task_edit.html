{% load djicons i18n %}

<div x-data="{ confirmDelete: false }">

<div class="side-sheet-header">
    <h3 class="sheet-title">{% trans "Edit Task" %}</h3>
    <button class="sheet-close" @click="closePanel()">{% icon "close-outline" %}</button>
</div>

<div class="side-sheet-content">
    <form id="edit-task-form"
          hx-post="{% url 'tasks:task_edit' obj.id %}"
          hx-target="#datatable-body"
          hx-swap="innerHTML"
          @htmx:after-request="closePanel()"
          class="flex flex-col gap-4 p-6">
        {% csrf_token %}

        {% if error %}
        <div class="callout callout-error">
            <div class="callout-content"><span class="callout-text">{{ error }}</span></div>
        </div>
        {% endif %}

        <div>
            <label class="text-sm font-medium mb-1 block">{% trans "Title" %}</label>
            <input type="text" name="title" class="input input-sm w-full" value="{{ obj.title }}">
        </div>

        <div>
            <label class="text-sm font-medium mb-1 block">{% trans "Description" %}</label>
            <textarea name="description" class="textarea textarea-sm w-full" rows="3">{{ obj.description }}</textarea>
        </div>

        <div>
            <label class="text-sm font-medium mb-1 block">{% trans "Task Type" %}</label>
            <select name="task_type" class="select select-sm w-full">
                <option value="">---</option>
            </select>
        </div>

        <div>
            <label class="text-sm font-medium mb-1 block">{% trans "Priority" %}</label>
            <select name="priority" class="select select-sm w-full">
                <option value="">---</option>
            </select>
        </div>

        <div>
            <label class="text-sm font-medium mb-1 block">{% trans "Status" %}</label>
            <select name="status" class="select select-sm w-full">
                <option value="">---</option>
            </select>
        </div>

        <div>
            <label class="text-sm font-medium mb-1 block">{% trans "Due Date" %}</label>
            <input type="datetime-local" name="due_date" class="input input-sm w-full" value="{{ obj.due_date }}">
        </div>

        <div>
            <label class="text-sm font-medium mb-1 block">{% trans "Completed At" %}</label>
            <input type="datetime-local" name="completed_at" class="input input-sm w-full" value="{{ obj.completed_at }}">
        </div>

        <div>
            <label class="text-sm font-medium mb-1 block">{% trans "Assigned To" %}</label>
            <input type="text" name="assigned_to" class="input input-sm w-full" value="{{ obj.assigned_to }}">
        </div>

        <div>
            <label class="text-sm font-medium mb-1 block">{% trans "Related Lead" %}</label>
            <input type="text" name="related_lead" class="input input-sm w-full" value="{{ obj.related_lead }}">
        </div>

        <div>
            <label class="text-sm font-medium mb-1 block">{% trans "Duration Minutes" %}</label>
            <input type="number" name="duration_minutes" class="input input-sm w-full" value="{{ obj.duration_minutes }}">
        </div>

        <div>
            <label class="text-sm font-medium mb-1 block">{% trans "Result" %}</label>
            <textarea name="result" class="textarea textarea-sm w-full" rows="3">{{ obj.result }}</textarea>
        </div>

        <div>
            <label class="text-sm font-medium mb-1 block">{% trans "Location" %}</label>
            <input type="text" name="location" class="input input-sm w-full" value="{{ obj.location }}">
        </div>

        <div>
            <label class="text-sm font-medium mb-1 block">{% trans "Is Recurring" %}</label>
            <label class="toggle color-success">
                <input type="checkbox" name="is_recurring" {% if obj.is_recurring %}checked{% endif %}>
                <span class="toggle-track"><span class="toggle-thumb"></span></span>
            </label>
        </div>

        <div>
            <label class="text-sm font-medium mb-1 block">{% trans "Recurrence Rule" %}</label>
            <textarea name="recurrence_rule" class="textarea textarea-sm w-full" rows="3">{{ obj.recurrence_rule }}</textarea>
        </div>

        <div>
            <label class="text-sm font-medium mb-1 block">{% trans "Reminder Before Minutes" %}</label>
            <input type="number" name="reminder_before_minutes" class="input input-sm w-full" value="{{ obj.reminder_before_minutes }}">
        </div>
    </form>

    <div class="border-t border-base-300 pt-4 mt-4 px-6 pb-6">
        <h4 class="font-semibold text-sm mb-3 text-error">{% trans "Danger Zone" %}</h4>
        <template x-if="!confirmDelete">
            <button type="button" class="btn btn-sm btn-outline color-error w-full" @click="confirmDelete = true">
                {% icon "trash-outline" %} {% trans "Delete" %}
            </button>
        </template>
        <template x-if="confirmDelete">
            <div>
                <p class="text-error text-sm font-semibold mb-3">{% trans "Are you sure?" %}</p>
                <div class="flex gap-2">
                    <button type="button" class="btn btn-sm btn-outline flex-1" @click="confirmDelete = false">{% trans "Cancel" %}</button>
                    <button type="button" class="btn btn-sm color-error flex-1"
                            hx-post="{% url 'tasks:task_delete' obj.id %}"
                            hx-target="#datatable-body" hx-swap="innerHTML" @click="closePanel()">
                        {% icon "trash-outline" %} {% trans "Delete" %}
                    </button>
                </div>
            </div>
        </template>
    </div>
</div>

<div class="side-sheet-footer">
    <div class="flex justify-end gap-2">
        <button type="button" class="btn btn-ghost btn-sm" @click="closePanel()">{% trans "Cancel" %}</button>
        <button type="submit" form="edit-task-form" class="btn btn-sm color-primary">
            {% icon "checkmark-outline" %} {% trans "Save" %}
        </button>
    </div>
</div>

</div>
